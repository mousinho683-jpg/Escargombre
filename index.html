<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Escargombre üêåüî• ‚Äî Prototype Web</title>
<style>
  :root{
    --bg:#0f1221; --panel:#171a2c; --ink:#eaf0ff; --muted:#97a0c0;
    --accent:#7cfcc2; --accent2:#ffd166; --danger:#ff5470; --ok:#7cff7c;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;
    color:var(--ink); background:#070912;
    display:flex; flex-direction:column; gap:16px; padding:16px;
  }
  header h1{margin:0; font-size:clamp(20px,3.8vw,36px)}
  canvas{width:100%; height:auto; border-radius:12px; background:#0b0d18; border:1px solid rgba(255,255,255,0.08)}
  .hud{display:grid; grid-template-columns: repeat(3,1fr); gap:10px; margin-top:10px}
  .meter{background:#0c1122; border:1px solid rgba(255,255,255,0.1); border-radius:10px; padding:8px}
  .meter .bar{height:10px; border-radius:8px; background:linear-gradient(90deg,var(--accent),#4be3ff); width:0%}
  .meter .bar.heat{background:linear-gradient(90deg,#f7a,#f33)}
  .meter .bar.boost{background:linear-gradient(90deg,#9f7cff,#6af)}
  .meter small{display:block; color:var(--muted)}
  footer{color:var(--muted); font-size:12px; margin-top:4px}

  /* Joystick */
  #joystick {
    position: fixed;
    bottom: 40px;
    left: 40px;
    width: 120px;
    height: 120px;
    background: rgba(255,255,255,0.05);
    border: 2px solid rgba(255,255,255,0.2);
    border-radius: 50%;
    touch-action: none;
    user-select: none;
  }
  #stick {
    width: 50px;
    height: 50px;
    background: rgba(255,0,0,0.7);
    border-radius: 50%;
    position: absolute;
    top: 35px;
    left: 35px;
    transition: 0.05s;
  }
</style>
</head>
<body>
  <header>
    <h1>Escargombre <span style="color:var(--accent2)">prototype</span></h1>
    <div class="subtitle">üêå Mange des feuilles pour acc√©l√©rer, √©vite l‚Äôombre qui br√ªle, trouve la sortie üü™ !</div>
  </header>

  <main>
    <canvas id="gameCanvas" width="480" height="360"></canvas>
    <div class="hud">
      <div class="meter">
        <small>Chaleur Ombre</small>
        <div class="bar heat" id="heatBar"></div>
      </div>
      <div class="meter">
        <small>Boost Vitesse</small>
        <div class="bar boost" id="boostBar"></div>
      </div>
      <div class="meter">
        <small>Progr√®s Niveau</small>
        <div class="bar" id="progressBar"></div>
      </div>
    </div>
  </main>

  <!-- joystick -->
  <div id="joystick">
    <div id="stick"></div>
  </div>

  <footer>Prototype Escargombre ‚Äî 2025</footer>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const heatBar = document.getElementById('heatBar');
const boostBar = document.getElementById('boostBar');
const progressBar = document.getElementById('progressBar');

const tileSize = 32;
let map = [
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
  [1,0,0,2,0,0,0,0,0,0,0,0,0,3,1],
  [1,0,1,1,1,0,1,1,1,0,1,1,1,0,1],
  [1,0,0,0,0,0,0,0,0,0,0,2,0,0,1],
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];
let player = {x:1, y:1, heat:0, boost:0, progress:0, lives:3};

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let y=0;y<map.length;y++){
    for(let x=0;x<map[y].length;x++){
      switch(map[y][x]){
        case 0: ctx.fillStyle="#0f1324"; break; // sol
        case 1: ctx.fillStyle="#555a6b"; break; // mur
        case 2: ctx.fillStyle="#2b6a3f"; break; // feuille
        case 3: ctx.fillStyle="#6a5acd"; break; // sortie
      }
      ctx.fillRect(x*tileSize, y*tileSize, tileSize, tileSize);
    }
  }
  // escargot
  ctx.fillStyle="#fff";
  ctx.fillRect(player.x*tileSize, player.y*tileSize, tileSize, tileSize);

  // vies (petits c≈ìurs rouges)
  for(let i=0;i<player.lives;i++){
    ctx.fillStyle="red";
    ctx.fillRect(player.x*tileSize + i*12, player.y*tileSize-10, 10, 10);
  }
}

function step(dx,dy){
  const nx = player.x + dx;
  const ny = player.y + dy;
  if(map[ny][nx] !== 1){
    player.x = nx; player.y = ny;
    const tile = map[ny][nx];
    if(tile === 2) player.boost = Math.min(100, player.boost+20);
    if(tile === 3) alert("üéâ Niveau termin√© !");
    player.heat = Math.min(100, player.heat+5);
    player.progress = Math.min(100, player.progress+10);
    if(player.heat >= 100){
      player.lives--;
      player.heat = 0;
      if(player.lives <= 0){ alert("üíÄ Tu as perdu !"); }
    }
    updateHUD();
  }
}

function updateHUD(){
  heatBar.style.width = player.heat + "%";
  boostBar.style.width = player.boost + "%";
  progressBar.style.width = player.progress + "%";
}

draw();
updateHUD();

// clavier
document.addEventListener('keydown',e=>{
  switch(e.key){
    case 'ArrowUp': step(0,-1); break;
    case 'ArrowDown': step(0,1); break;
    case 'ArrowLeft': step(-1,0); break;
    case 'ArrowRight': step(1,0); break;
  }
  draw();
});

// joystick
let joystick = document.getElementById("joystick");
let stick = document.getElementById("stick");
let joyActive = false;

joystick.addEventListener("touchstart", e=>{
  joyActive = true;
}, false);
joystick.addEventListener("touchend", e=>{
  joyActive = false;
  stick.style.left = "35px";
  stick.style.top = "35px";
}, false);
joystick.addEventListener("touchmove", e=>{
  if(!joyActive) return;
  let touch = e.touches[0];
  let rect = joystick.getBoundingClientRect();
  let x = touch.clientX - (rect.left + rect.width/2);
  let y = touch.clientY - (rect.top + rect.height/2);
  let dist = Math.sqrt(x*x + y*y);
  let maxDist = rect.width/2 - 20;
  if(dist > maxDist){
    x *= maxDist/dist;
    y *= maxDist/dist;
  }
  stick.style.left = (rect.width/2 + x - 25) + "px";
  stick.style.top = (rect.height/2 + y - 25) + "px";

  let dx = Math.round(x / maxDist);
  let dy = Math.round(y / maxDist);

  if(dx!==0 || dy!==0){
    step(dx, dy);
    draw();
  }
}, false);
</script>
</body>
</html>
