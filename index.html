<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Escargombre 🐌🔥</title>
<style>
  body{margin:0;background:#0b0e1b;color:#fff;font-family:sans-serif;display:flex;flex-direction:column;align-items:center;padding:10px}
  canvas{background:#0f1324;border:2px solid #333;image-rendering:pixelated}
  #mobile-controls{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);display:grid;grid-template-columns:repeat(3,60px);grid-template-rows:repeat(3,60px);gap:10px;z-index:1000}
  #mobile-controls button{font-size:24px;border:none;border-radius:8px;background:#222;color:#fff}
  .hud{margin-top:10px;display:flex;gap:20px;align-items:center}
  .bar{width:120px;height:10px;background:#222;border:1px solid #555;border-radius:5px;overflow:hidden}
  .fill{height:100%;background:red;width:0%}
  .hearts{display:flex;gap:4px}
  .heart{width:12px;height:12px;background:red;border-radius:2px}
</style>
</head>
<body>

<h1>Escargombre 🐌🔥</h1>
<canvas id="gameCanvas" width="480" height="320"></canvas>

<div class="hud">
  <div>Chaleur: <div class="bar"><div class="fill" id="heatBar"></div></div></div>
  <div class="hearts" id="hearts"></div>
  <button id="newLevelBtn">Nouveau niveau</button>
</div>

<!-- Contrôles mobiles -->
<div id="mobile-controls">
  <div></div><button onclick="step(0,-1)">⬆️</button><div></div>
  <button onclick="step(-1,0)">⬅️</button><div></div>
  <button onclick="step(1,0)">➡️</button>
  <div></div><button onclick="step(0,1)">⬇️</button><div></div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const heatBar = document.getElementById("heatBar");
const heartsContainer = document.getElementById("hearts");
const tileSize = 32;
const cols = 15, rows = 10;

let levels = [];
let unlockedLevel = 0;
let currentLevel = 0;
let player, map;

function generateLevels(){
  for(let i=0;i<128;i++){
    let grid = Array.from({length:rows},()=>Array(cols).fill(0));
    // murs bordures
    for(let x=0;x<cols;x++){grid[0][x]=1;grid[rows-1][x]=1;}
    for(let y=0;y<rows;y++){grid[y][0]=1;grid[y][cols-1]=1;}
    // obstacles, ombre, feuilles
    for(let y=1;y<rows-1;y++){
      for(let x=1;x<cols-1;x++){
        if(Math.random()<0.1) grid[y][x]=1; // mur
        else if(Math.random()<0.1) grid[y][x]=4; // ombre
        else if(Math.random()<0.1) grid[y][x]=2; // feuille
      }
    }
    // sortie violette
    grid[rows-2][cols-2] = 3;
    // départ
    player = {x:1,y:1,heat:0,boost:0,lives:3};
    levels.push(grid);
  }
}

function loadLevel(n){
  map = JSON.parse(JSON.stringify(levels[n]));
  player.x=1;player.y=1;
  player.heat=0;player.boost=0;player.lives=3;
  updateHUD();
  draw();
}

function updateHUD(){
  heatBar.style.width = player.heat + "%";
  heartsContainer.innerHTML="";
  for(let i=0;i<player.lives;i++){
    let h=document.createElement("div");
    h.className="heart";
    heartsContainer.appendChild(h);
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let y=0;y<rows;y++){
    for(let x=0;x<cols;x++){
      switch(map[y][x]){
        case 0: ctx.fillStyle="#0f1324"; break; // vide
        case 1: ctx.fillStyle="#555a6b"; break; // mur
        case 2: ctx.fillStyle="#2b6a3f"; break; // feuille
        case 3: ctx.fillStyle="#6a5acd"; break; // sortie
        case 4: ctx.fillStyle="#1a1f2f"; break; // ombre
      }
      ctx.fillRect(x*tileSize,y*tileSize,tileSize,tileSize);
    }
  }
  // escargot
  ctx.fillStyle="#fff";
  ctx.fillRect(player.x*tileSize,player.y*tileSize,tileSize,tileSize);
}

function step(dx,dy){
  let nx = player.x+dx;
  let ny = player.y+dy;
  if(nx<0||ny<0||nx>=cols||ny>=rows) return;
  if(map[ny][nx]===1) return;
  player.x=nx;player.y=ny;
  let tile = map[ny][nx];
  if(tile===2){player.boost=Math.min(100,player.boost+20);player.heat=Math.max(0,player.heat-20);map[ny][nx]=0;}
  if(tile===3){
    alert("Niveau terminé !");
    unlockedLevel=Math.max(unlockedLevel,currentLevel+1);
  }
  if(tile===4){player.heat+=20;} else {player.heat=Math.max(0,player.heat-5);}
  if(player.heat>=100){
    player.lives--;
    player.heat=0;
    if(player.lives<=0){alert("Game Over");loadLevel(currentLevel);return;}
  }
  updateHUD();
  draw();
}

document.addEventListener("keydown",e=>{
  if(e.key==="ArrowUp") step(0,-1);
  if(e.key==="ArrowDown") step(0,1);
  if(e.key==="ArrowLeft") step(-1,0);
  if(e.key==="ArrowRight") step(1,0);
});

document.getElementById("newLevelBtn").addEventListener("click",()=>{
  if(currentLevel<unlockedLevel+1 && currentLevel<127){
    currentLevel++;
    loadLevel(currentLevel);
  }else{
    alert("Niveau verrouillé !");
  }
});

generateLevels();
loadLevel(0);
</script>

</body>
</html>
